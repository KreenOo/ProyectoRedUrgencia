<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Fichas de Pacientes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'css/estilo_base.css' %}" rel="stylesheet" type="text/css">
    <style>
        .form-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            background: white;
            color: #3b3b98;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">RedUrgencia</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/menu_receptor">Volver</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/login">Cerrar sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="form-container">
        <h1 class="mb-4">Buscar Paciente</h1>

        <form method="GET" class="row g-3 mb-4">
            <div class="col-md-6">
                <label for="q" class="form-label">Nombre o RUT</label>
                <input type="text" class="form-control" name="q" id="q" value="{{ request.GET.q }}">
            </div>

            <div class="col-md-3">
                <label for="edad_min" class="form-label">Edad desde</label>
                <input type="number" class="form-control" name="edad_min" value="{{ request.GET.edad_min }}">
            </div>

            <div class="col-md-3">
                <label for="edad_max" class="form-label">Edad hasta</label>
                <input type="number" class="form-control" name="edad_max" value="{{ request.GET.edad_max }}">
            </div>

            <div class="col-md-3">
                <label for="fecha_inicio" class="form-label">Fecha desde</label>
                <input type="date" class="form-control" name="fecha_inicio" value="{{ request.GET.fecha_inicio }}">
            </div>

            <div class="col-md-3">
                <label for="fecha_fin" class="form-label">Fecha hasta</label>
                <input type="date" class="form-control" name="fecha_fin" value="{{ request.GET.fecha_fin }}">
            </div>

            <div class="col-md-3">
                <label for="hora_inicio" class="form-label">Hora desde</label>
                <input type="time" class="form-control" name="hora_inicio" value="{{ request.GET.hora_inicio }}">
            </div>

            <div class="col-md-3">
                <label for="hora_fin" class="form-label">Hora hasta</label>
                <input type="time" class="form-control" name="hora_fin" value="{{ request.GET.hora_fin }}">
            </div>

            <div class="col-md-3">
                <label for="sexo" class="form-label">Sexo</label>
                <select name="sexo" class="form-select">
                    <option value="">Todos</option>
                    <option value="Masculino" {% if request.GET.sexo == 'Masculino' %}selected{% endif %}>Masculino</option>
                    <option value="Femenino" {% if request.GET.sexo == 'Femenino' %}selected{% endif %}>Femenino</option>
                    <option value="Otro" {% if request.GET.sexo == 'Otro' %}selected{% endif %}>Otro</option>
                </select>
            </div>

            <div class="col-md-3 form-check align-self-end">
                <input type="checkbox" class="form-check-input" id="sin_nombre" name="sin_nombre" {% if request.GET.sin_nombre %}checked{% endif %}>
                <label class="form-check-label" for="sin_nombre">Sin nombre</label>
            </div>

            <div class="col-md-3 form-check align-self-end">
                <input type="checkbox" class="form-check-input" id="sin_rut" name="sin_rut" {% if request.GET.sin_rut %}checked{% endif %}>
                <label class="form-check-label" for="sin_rut">Sin RUT</label>
            </div>

            <div class="col-md-12 d-grid mt-2">
                <button type="submit" class="btn btn-primary">Buscar</button>
            </div>
        </form>

        {% if pacientes %}
        <div class="accordion" id="pacienteAccordion">
            {% for paciente in pacientes %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                        Ficha #{{ forloop.counter }} - {{ paciente.fecha }} {{ paciente.hora }}
                    </button>
                </h2>
                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#pacienteAccordion">
                    <div class="accordion-body">
                        <ul class="nav nav-tabs mb-3" id="tabs{{ forloop.counter }}" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#datos{{ forloop.counter }}">Datos Personales</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#clinico{{ forloop.counter }}">Estado Clínico</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="datos{{ forloop.counter }}">
                                <p><strong>Nombre:</strong> {{ paciente.nombre|default:"(Sin nombre)" }}</p>
                                <p><strong>Edad:</strong> {{ paciente.edad|default:"(No Existe Edad)" }}</p>
                                <p><strong>RUT:</strong> {{ paciente.rut|default:"(Sin RUT)" }}</p>
                                <p><strong>Sexo:</strong> {{ paciente.sexo|default:"(No Existe Sexo)" }}</p>
                                <p><strong>Dirección:</strong> {{ paciente.direccion|default:"(No Existe Direccion)" }}</p>
                                <p><strong>Teléfono:</strong> {{ paciente.telefono|default:"(No Existe Telefono)" }}</p>
                            </div>
                            <div class="mt-3">
                                <p><strong>Alergias:</strong> {{ paciente.alergias|default:"(No Existen Alergias)" }}</p>
                                <p><strong>Estado de Conciencia:</strong> {{ paciente.estado_conciencia|default:"(No Existe Estado de Conciencia)" }}</p>
                                <p><strong>Estado de Pupilas:</strong> {{ paciente.estado_pupilas|default:"(No Existe Estado de Pupilas)" }}</p>
                                <p><strong>Presión Arterial:</strong> {{ paciente.presion_arterial|default:"(No Existe Presión Arterial)" }}</p>
                                <p><strong>Frecuencia Cardíaca:</strong> {{ paciente.frecuencia_cardiaca|default:"(No Existe Frecuencia Cardíaca)" }}</p>
                                <p><strong>Frecuencia Respiratoria:</strong> {{ paciente.frecuencia_respiratoria|default:"(No Existe Frecuencia Respiratoria)" }}</p>
                                <p><strong>Temperatura:</strong> {{ paciente.temperatura|default:"(No Existe Temperatura)" }}</p>
                                <p><strong>Saturación de Oxígeno:</strong> {{ paciente.saturacion_oxigeno|default:"(No Existe Saturación)" }}</p>
                                <p><strong>Nivel de Glucosa:</strong> {{ paciente.nivel_glucosa|default:"(No Existe Nivel de Glucosa)" }}</p>
                                <p><strong>Síntomas:</strong><br />{{ paciente.sintomas|default:"(No Existen Sintomas)" }}</p>
                                <p><strong>Lesiones visibles:</strong><br />{{ paciente.lesiones|default:"(No Existen Lesiones Visibles)" }}</p>
                                <p><strong>Observaciones:</strong><br />{{ paciente.observaciones|default:"(No Existen Observaciones)" }}</p>
                            </div>
                        </div>
                        <a href="/detalle/{{ paciente.id }}" class="btn btn-primary mt-3">Ver Detalles</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
            <p class="text-center">No se encontraron fichas con los criterios ingresados.</p>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
