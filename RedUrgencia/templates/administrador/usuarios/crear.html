<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Crear Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="{% static 'css/estilo_base.css' %}" rel="stylesheet" type="text/css" />
</head>
<body>

<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">RedUrgencia</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/menu_admin_usuario">Volver</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/login">Cerrar sesión</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="form-container">
    <h1>Registrar Usuario - Administrador</h1>

    <form method="post" autocomplete="off" class="needs-validation" novalidate>
        {% csrf_token %}

        <div class="mb-3">
            <label for="usuario">Usuario</label>
            <input type="text" id="usuario" name="usuario" class="form-control"
                   pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$" minlength="6"
                   title="Solo letras y espacios" required>
            <div class="invalid-feedback">Ingrese un nombre de usuario válido (mínimo 6 letras, sin números).</div>
        </div>
        <div class="mb-3">
            <label for="nombre">Nombre y Apellido</label>
            <input
                type="text"
                id="nombre"
                class="form-control"
                name="nombre"
                minlength="3"
                pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$"
                title="Solo letras y espacios"
                oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ\s]/g, '')"
            />
            <div class="invalid-feedback">
                Ingrese al menos 3 letras. No se permiten números ni caracteres especiales.
            </div>
        </div>
        <div class="mb-3">
            <label for="rut">RUT</label>
            <input type="text" id="rut" name="rut" class="form-control"
                   pattern="^\d{7,9}$" placeholder="Solo números, sin puntos ni guiones" required>
            <div class="invalid-feedback">RUT inválido (7 a 9 dígitos).</div>
        </div>
        <div class="mb-3">
            <label for="rol">Rol</label>
            <select id="rol" name="rol" class="form-control" required>
                <option value="">Seleccione</option>
                <option value="Administrador">Administrador</option>
                <option value="Médico">Médico</option>
                <option value="Paramédico">Paramédico</option>
            </select>
            <div class="invalid-feedback">Seleccione un rol.</div>
        </div>
        <div class="mb-3">
            <label for="password">Contraseña</label>
            <input type="password" id="password" name="password" class="form-control" minlength="6" required>
            <div class="invalid-feedback">La contraseña debe tener al menos 6 caracteres.</div>
        </div>
        <div class="mb-3">
            <label for="confirm_password">Confirmar contraseña</label>
            <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
            <div class="invalid-feedback" id="passwordMismatch">Las contraseñas no coinciden.</div>
        </div>

        <button type="submit" class="btn btn-success w-100 mt-3">Registrar Usuario</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    (function () {
        "use strict";
        window.addEventListener("load", function () {
            const form = document.querySelector(".needs-validation");
            const password = document.getElementById("password");
            const confirmPassword = document.getElementById("confirm_password");

            form.addEventListener("submit", function (event) {
                if (!form.checkValidity() || password.value !== confirmPassword.value) {
                    event.preventDefault();
                    event.stopPropagation();

                    if (password.value !== confirmPassword.value) {
                        confirmPassword.classList.add("is-invalid");
                        document.getElementById("passwordMismatch").style.display = "block";
                    } else {
                        confirmPassword.classList.remove("is-invalid");
                        document.getElementById("passwordMismatch").style.display = "none";
                    }
                }
                form.classList.add("was-validated");
            }, false);
        }, false);
    })();
</script>

</body>
</html>
